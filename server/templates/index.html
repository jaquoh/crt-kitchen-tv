<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CRT Kitchen TV</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 20px auto; }
    label { display:block; margin-top:10px; font-weight:bold; }
    input[type=text], input[type=number] { width:100%; padding:6px; }
    .list { margin-bottom: 10px; }
    button { padding:10px 14px; font-size:16px; }
    .error { color: #b00; }
    pre { background:#111; color:#ddd; padding:10px; overflow:auto; max-height:240px; white-space:pre-wrap; }
    .logs { margin-top:24px; border-top:1px solid #ccc; padding-top:16px; }
    .row { display:flex; gap:8px; align-items:center; margin-top:6px; }
    .row input { width:120px; }
  </style>
</head>
<body>
  <h1>CRT Kitchen TV</h1>
  {% if errors %}
    <div class="error">
      <p>Errors:</p>
      <ul>{% for e in errors %}<li>{{e}}</li>{% endfor %}</ul>
    </div>
  {% endif %}
  <form action="/save" method="post">
    <label>News stream URLs (one per line)</label>
    <textarea name="news_streams" rows="3" style="width:100%">{{"\n".join(cfg.get("news_streams", []))}}</textarea>

    <label>Movies directory</label>
    <input type="text" name="movies_dir" value="{{cfg.get('movies_dir','')}}" />

    <label>Media root</label>
    <input type="text" name="media_root" value="{{cfg.get('media_root','/var/lib/crt-kitchen-tv/media')}}" />

    <label>Collections (one folder name per line)</label>
    <textarea name="collections" rows="4" style="width:100%">{{"\n".join(cfg.get("collections", ["Inbox", "News", "Movies"]))}}</textarea>

    <label>Library sort</label>
    <select name="library_sort">
      {% for opt in ['newest','alpha'] %}
        <option value="{{opt}}" {% if cfg.get('library_sort','newest')==opt %}selected{% endif %}>{{opt}}</option>
      {% endfor %}
    </select>

    <label>mpv backend</label>
    <select name="mpv_backend">
      {% for opt in ['drm','sdl','x11','auto'] %}
        <option value="{{opt}}" {% if cfg.get('mpv_backend','drm')==opt %}selected{% endif %}>{{opt}}</option>
      {% endfor %}
    </select>

    <label>Audio output</label>
    <select name="audio_output">
      {% for opt in ['respeaker','hdmi','analog'] %}
        <option value="{{opt}}" {% if cfg.get('audio_output')==opt %}selected{% endif %}>{{opt}}</option>
      {% endfor %}
    </select>

    <label>Font size</label>
    <input type="number" name="font_size" value="{{cfg.get('font_size',48)}}" />

    <label>Overscan (top/bottom/left/right)</label>
    <div style="display:flex; gap:6px;">
      <input type="number" name="overscan[top]" value="{{cfg.get('overscan',{}).get('top',0)}}" placeholder="top" />
      <input type="number" name="overscan[bottom]" value="{{cfg.get('overscan',{}).get('bottom',0)}}" placeholder="bottom" />
      <input type="number" name="overscan[left]" value="{{cfg.get('overscan',{}).get('left',0)}}" placeholder="left" />
      <input type="number" name="overscan[right]" value="{{cfg.get('overscan',{}).get('right',0)}}" placeholder="right" />
    </div>

    <label><input type="checkbox" name="leds_enabled" {% if cfg.get('leds_enabled',True) %}checked{% endif %}/> Enable LEDs</label>

    <div style="margin-top:16px;">
      <button type="submit">Save</button>
    </div>
  </form>

  <div class="logs">
    <h2>Diagnostics</h2>
    <form method="get" action="/" class="row">
      <label for="lines" style="margin:0;">Log lines</label>
      <input id="lines" type="number" name="lines" min="20" max="500" value="{{lines or 120}}" />
      <button type="submit">Refresh Logs</button>
    </form>

    <h3>UI debug (`/tmp/crt-kitchen-tv-ui.log`)</h3>
    <pre>{{ (logs or {}).get('ui_debug', 'No data') }}</pre>

    <h3>mpv debug (`/tmp/crt-kitchen-tv-mpv.log`)</h3>
    <pre>{{ (logs or {}).get('mpv_debug', 'No data') }}</pre>

    <h3>Service log (`crt-ui.service`)</h3>
    <pre>{{ (logs or {}).get('crt_ui_service', 'No data') }}</pre>

    <h3>Service log (`crt-web.service`)</h3>
    <pre>{{ (logs or {}).get('crt_web_service', 'No data') }}</pre>

    <h3>ReSpeaker driver log</h3>
    <pre>{{ (logs or {}).get('respeaker_driver', 'No data') }}</pre>
  </div>
</body>
</html>
